<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>游戏角色面板</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            height: 100vh;
        }

        .left,
        .center,
        .right {
            border: 1px solid #123;
            box-sizing: border-box;
            padding: 30px;
        }

        .center {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #c4c4c4;
            overflow: hidden;
        }

        .center img {
            height: 100vh;
            width: auto;
            transform-origin: center center;
        }

        .right {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 血量模块 */
        .hp-container {
            border: 2px solid #666;
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            margin-bottom: 15px;
        }

        .hp-container h3 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .hp-armor {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }

        .stat {
            text-align: center;
            margin: 0 5px;
        }

        .stat button {
            display: block;
            width: 40px;
            height: 40px;
            font-size: 18px;
            margin: 4px auto;
        }

        #hpValue,
        #armorValue {
            font-weight: bold;
            padding: 5px;
            border-radius: 4px;
            font-size: 24px;
        }

        /* 快速操作模块 */
        .quick-ops {
            border: 2px solid #666;
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            margin-bottom: 15px;
        }

        .quick-ops h3 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            width: 100%;
        }

        .button-grid button {
            width: 100%;
            height: 40px;
            font-size: 16px;
        }

        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            max-width: 800px;
        }

        .modal-content h2 {
            margin-bottom: 20px;
        }

        .faction-images {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }

        .faction-images img {
            width: 100px;
            height: auto;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .faction-images img:hover {
            transform: scale(1.1);
        }

        #closeModal,
        #closeAbolishModal {
            margin-top: 20px;
            padding: 8px 16px;
            font-size: 16px;
        }

        /* 废除弹窗 */
        .abolish-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .abolish-buttons button {
            height: 50px;
            font-size: 16px;
        }

        .suit {
            font-size: 15px;
            font-weight: bold;
            color: transparent;
            /* 隐藏原始字体颜色 */
            text-shadow: 0 0 0 gray;
            /* 初始灰色 */
            border: 1px solid #aaa;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            background: white;
        }

        /* 激活状态：不同花色显示不同颜色 */
        .suit.active.spade,
        .suit.active.club {
            text-shadow: 0 0 0 black;
        }

        .suit.active.heart,
        .suit.active.diamond {
            text-shadow: 0 0 0 red;
        }
    </style>
</head>

<body>
    <!-- 左侧 -->
    <div class="left">
        <!-- 基础信息模块 -->
        <div class="info-container"
            style="border: 2px solid #666; border-radius: 8px; padding: 10px; width: 100%; margin-bottom: 15px;">
            <h3 style="text-align:center; margin-top:0; margin-bottom:10px;">基础信息</h3>
            <div style="display:flex; justify-content:space-around; align-items:center;">
                <img id="factionIcon" src="/static/icons/qun.png" alt="势力"
                    style="width:50px; height:auto; cursor:pointer;">
                <div id="roleSection" style="font-size:20px; font-weight:bold; cursor:pointer;">
                    {% if role == "主公" %}
                    <span style="color:darkred;">主公</span>
                    {% else %}
                    查看身份
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- 标记模块 -->
        <div class="marker-container"
            style="border: 2px solid #666; border-radius: 8px; padding: 10px; width: 100%; flex-grow:1; display:flex; flex-direction:column;">
            <h3 style="text-align:center; margin-top:0; margin-bottom:10px;">标记</h3>
            <button style="margin-bottom:10px;">添加标记</button>
            <!-- 花色按钮区域 -->
            <div class="suit-buttons" style="display:flex; justify-content:space-around; margin-bottom:10px;">
                <button class="suit spade">♠</button>
                <button class="suit heart">♥</button>
                <button class="suit diamond">♦</button>
                <button class="suit club">♣</button>
            </div>
            <div id="markerContainer" style="flex-grow:1; overflow-y:auto;">
                <div id="markerList"></div>
            </div>
        </div>

        <!-- 标记输入弹窗 -->
        <div id="markerModal" class="modal">
            <div class="modal-content">
                <h2>添加标记</h2>
                <div style="margin:10px 0;">
                    <label>标记名称: <input type="text" id="markerName"></label>
                </div>
                <div style="margin:10px 0;">
                    <label>数量: <input type="number" id="markerCount" value="1" min="1"></label>
                </div>
                <button id="confirmMarker">确定</button>
                <button id="cancelMarker">取消</button>
            </div>
        </div>
    </div>

    <!-- 中间角色区 -->
    <div class="center">
        {% if image_file_a and image_file_b %}
        <div style="position: relative; display: inline-block;">
            <img id="characterImage" src="{{ url_for('static', filename=image_file_a) }}"
                data-img-a="{{ url_for('static', filename=image_file_a) }}"
                data-img-b="{{ url_for('static', filename=image_file_b) }}" alt="角色">
            <img id="chainOverlay" src="/static/icons/chain_mode.png"
                style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:100%; height:auto; pointer-events:none;">
        </div>
        {% else %}
        <div style="color:white;">⚠️ 没有找到角色图片</div>
        {% endif %}
    </div>

    <!-- 提示弹窗 -->
    <div id="hintModal" class="modal" style="display:flex;">
        <div class="modal-content">
            <h2>单击武将切换状态</h2>
            <button id="closeHint">确定</button>
        </div>
    </div>

    <!-- 右侧 -->
    <div class="right">
        <!-- 血量模块 -->
        <div class="hp-container">
            <h3>血量</h3>
            <div class="hp-armor">
                <div class="stat">
                    <div style="display: flex; align-items: center; justify-content: center;">
                        <div>
                            <button onclick="changeHp(1)">▲</button>
                            <button onclick="changeHp(-1)">▼</button>
                        </div>
                        <div id="hpValue" style="margin: 0 10px;">4/4</div>
                        <div>
                            <button onclick="changeMaxHp(1)">▲</button>
                            <button onclick="changeMaxHp(-1)">▼</button>
                        </div>
                    </div>
                    <div>血量/上限</div>
                </div>
                <div class="stat">
                    <button onclick="changeArmor(1)">▲</button>
                    <div id="armorValue">0</div>
                    <button onclick="changeArmor(-1)">▼</button>
                    <div>护甲</div>
                </div>
            </div>
        </div>

        <!-- 快速操作模块 -->
        <div class="quick-ops">
            <h3>快速操作</h3>
            <div class="button-grid">
                <button id="tapButton">横置</button>
                <button id="flipButton">翻面</button>
                <button>暗置</button>
                <button id="abolishButton">废除</button>
            </div>
        </div>
    </div>

    <!-- 废除弹窗 -->
    <div id="abolishModal" class="modal">
        <div class="modal-content">
            <h2>选择需要废除/复原的区域</h2>
            <div class="abolish-buttons">
                <button>判定区</button>
                <button>武器</button>
                <button>防具</button>
                <button>进攻马</button>
                <button>防御马</button>
                <button>宝物</button>
            </div>
            <button id="closeAbolishModal">返回</button>
        </div>
    </div>

    <!-- 势力选择弹窗 -->
    <div id="factionModal" class="modal">
        <div class="modal-content">
            <h2>选择势力</h2>
            <div class="faction-images">
                <img src="/static/icons/wei.png" alt="魏">
                <img src="/static/icons/shu.png" alt="蜀">
                <img src="/static/icons/wu.png" alt="吴">
                <img src="/static/icons/qun.png" alt="群">
                <img src="/static/icons/jin.png" alt="晋">
            </div>
            <button id="closeModal">返回</button>
        </div>
    </div>
    <!-- 身份弹窗 -->
    <div id="roleModal" class="modal">
        <div class="modal-content">
            <h2>你的身份是：{{ role }}</h2>
            <button id="closeRoleModal">关闭</button>
        </div>
    </div>
    <script>
        // === 状态数据 ===
        let hp = 4;
        let maxHp = 4;
        let armor = 0;
        let isTapped = false;
        let isFlipped = false;

        const charImg = document.getElementById("characterImage");
        const chainOverlay = document.getElementById("chainOverlay");
        const originalSrc = charImg ? charImg.src : "";

        // === 血量与护甲 ===
        function updateHpDisplay() {
            const hpDiv = document.getElementById("hpValue");
            hpDiv.textContent = `${hp}/${maxHp}`;
            if (maxHp === 0 || hp === 0) {
                hpDiv.style.color = "gray";
            } else if (hp === maxHp) {
                hpDiv.style.color = "green";
            } else if (hp === 2) {
                hpDiv.style.color = "orange";
            } else if (hp === 1) {
                hpDiv.style.color = "red";
            } else {
                hpDiv.style.color = "green";
            }
        }

        function updateArmorDisplay() {
            document.getElementById("armorValue").textContent = armor;
        }

        function changeHp(delta) {
            hp = Math.max(0, Math.min(maxHp, hp + delta));
            updateHpDisplay();
        }

        function changeMaxHp(delta) {
            maxHp = Math.max(0, maxHp + delta);
            if (hp > maxHp) hp = maxHp;
            updateHpDisplay();
        }

        function changeArmor(delta) {
            armor = Math.max(0, Math.min(5, armor + delta));
            updateArmorDisplay();
        }

        // === 横置、翻面 ===
        document.getElementById("tapButton").onclick = () => {
            if (!charImg) return;
            isTapped = !isTapped;
            if (isTapped) {
                chainOverlay.style.display = "block";
                chainOverlay.style.width = charImg.clientWidth + "px";
                tapButton.textContent = "竖置";
            } else {
                chainOverlay.style.display = "none";
                tapButton.textContent = "横置";
            }
        };

        document.getElementById("flipButton").onclick = () => {
            if (!charImg) return;
            isFlipped = !isFlipped;
            charImg.src = isFlipped ? "/static/icons/back.jpg" : originalSrc;
        };

        // === 废除弹窗 ===
        const abolishButton = document.getElementById("abolishButton");
        const abolishModal = document.getElementById("abolishModal");
        const closeAbolishModal = document.getElementById("closeAbolishModal");

        abolishButton.onclick = () => abolishModal.style.display = "flex";
        closeAbolishModal.onclick = () => abolishModal.style.display = "none";

        // 监听六个废除按钮
        const abolishBtns = abolishModal.querySelectorAll(".abolish-buttons button");
        abolishBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                const name = btn.textContent.trim();
                const markerList = document.getElementById("markerList");

                // 查找是否已有对应的“XX已废除”
                let existing = markerList.querySelector(`[data-abolish="${name}"]`);
                if (existing) {
                    // 已经存在则删除
                    existing.remove();
                } else {
                    // 否则添加
                    const row = document.createElement("div");
                    row.textContent = `${name}已废除`;
                    row.setAttribute("data-abolish", name);
                    row.style.color = "gray";
                    row.style.fontStyle = "italic";
                    row.style.padding = "3px 0";
                    markerList.appendChild(row);
                }
            });
        });

        // === 势力选择 ===
        const factionIcon = document.getElementById("factionIcon");
        const factionModal = document.getElementById("factionModal");
        const closeModal = document.getElementById("closeModal");

        factionIcon.onclick = () => factionModal.style.display = "flex";
        closeModal.onclick = () => factionModal.style.display = "none";

        document.querySelectorAll(".faction-images img").forEach(img => {
            img.addEventListener("click", function () {
                factionIcon.src = this.src;
                factionModal.style.display = "none";
            });
        });

        // === 标记功能 ===
        const markerBtn = document.querySelector(".left button");
        const markerModal = document.getElementById("markerModal");
        const confirmMarker = document.getElementById("confirmMarker");
        const cancelMarker = document.getElementById("cancelMarker");
        const markerList = document.getElementById("markerList");

        markerBtn.onclick = () => markerModal.style.display = "flex";
        cancelMarker.onclick = () => markerModal.style.display = "none";

        confirmMarker.onclick = () => {
            const name = document.getElementById("markerName").value.trim();
            let count = parseInt(document.getElementById("markerCount").value);
            if (!name || isNaN(count) || count <= 0) {
                alert("请输入正确的标记信息！");
                return;
            }
            addMarker(name, count);
            markerModal.style.display = "none";
            document.getElementById("markerName").value = "";
            document.getElementById("markerCount").value = 1;
        };

        function addMarker(name, count) {
            const row = document.createElement("div");
            row.style.display = "flex";
            row.style.alignItems = "center";
            row.style.justifyContent = "space-between";
            row.style.padding = "5px 0";
            row.style.borderBottom = "1px solid #ddd";

            const nameSpan = document.createElement("span");
            nameSpan.textContent = name;
            nameSpan.style.flex = "1";

            const countSpan = document.createElement("span");
            countSpan.textContent = count;
            countSpan.style.width = "30px";
            countSpan.style.textAlign = "center";

            const btns = document.createElement("div");
            btns.style.display = "flex";
            btns.style.gap = "5px";

            const incBtn = document.createElement("button");
            incBtn.textContent = "▲";
            incBtn.onclick = () => {
                count++;
                countSpan.textContent = count;
            };

            const decBtn = document.createElement("button");
            decBtn.textContent = "▼";
            decBtn.onclick = () => {
                if (count > 1) {
                    count--;
                    countSpan.textContent = count;
                }
            };

            const delBtn = document.createElement("button");
            delBtn.textContent = "X";
            delBtn.onclick = () => {
                if (confirm("确定要删除这个标记吗？")) {
                    row.remove();
                }
            };

            btns.appendChild(incBtn);
            btns.appendChild(decBtn);
            btns.appendChild(delBtn);

            row.appendChild(nameSpan);
            row.appendChild(countSpan);
            row.appendChild(btns);

            markerList.appendChild(row);
        }

        document.querySelectorAll(".suit").forEach(btn => {
            btn.addEventListener("click", () => {
                btn.classList.toggle("active");
            });
        });

        // === 查看身份功能 ===
        const roleSection = document.getElementById("roleSection");
        const roleModal = document.getElementById("roleModal");
        const closeRoleModal = document.getElementById("closeRoleModal");

        if (roleSection && roleSection.textContent.trim() === "查看身份") {
            roleSection.onclick = () => roleModal.style.display = "flex";
        }
        if (closeRoleModal) {
            closeRoleModal.onclick = () => roleModal.style.display = "none";
        }

        // === 图片切换功能 ===
        if (charImg) {
            let showingA = true;
            charImg.addEventListener("click", () => {
                showingA = !showingA;
                charImg.src = showingA ? charImg.dataset.imgA : charImg.dataset.imgB;
            });
        }

        // === 提示弹窗 ===
        const hintModal = document.getElementById("hintModal");
        const closeHint = document.getElementById("closeHint");
        closeHint.onclick = () => {
            hintModal.style.display = "none";
        };
        // === 初始化显示 ===
        updateHpDisplay();
        updateArmorDisplay();
    </script>
</body>

</html>